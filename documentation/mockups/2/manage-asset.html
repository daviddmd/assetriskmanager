<!--'a partir daqui edita-se o responsavel do ativo e todos os atributos do mesmo
'security officer tem acesso aos campos para editar o responsavel, desativar/reativar e eliminar ativo
'deve tambem ser possivel editar o estado interno do ativo a partir daqui com o SO
'https://plantuml.com/object-diagram
para editar o dependente atual, clicar no (X) e pesquisar por um novo. se nao tiver dependente, pesquisar por um novo.
deve vir pre-preenchido com detalhes do preenchido atualmente
-->
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <title>RJSC</title>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">RJSC</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link" href="#">Assets</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Users</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="configurationDropdown" role="button"
                       data-bs-toggle="dropdown" aria-expanded="false">
                        Manage
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="configurationDropdown">
                        <li><a class="dropdown-item" href="#">Threats</a></li>
                        <li><a class="dropdown-item" href="#">Controls</a></li>
                        <li><a class="dropdown-item" href="#">Permanent Contact Point</a></li>
                        <li><a class="dropdown-item" href="#">Security Officer Details</a></li>
                        <li><a class="dropdown-item" href="#">Asset Types</a> </li>
                        <li><a class="dropdown-item" href="#">Departments</a> </li>
                    </ul>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Reports</a>
                </li>
            </ul>
            <ul class="navbar-nav pull-right">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                       data-bs-toggle="dropdown" aria-expanded="false">
                        Security Officer
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <li><a class="dropdown-item" href="#">Profile</a></li>
                        <li><a class="dropdown-item" href="#">Logout</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>
<div class="container">
    <h2 class="text-center">Manage Asset #2</h2>
    <button id="editFormButton"><i class="bi bi-pencil"></i></button>
    <form id="assetForm">
        <div class="form-group">
            <label for="name">Asset Name</label>
            <input type="text" name="name" id="name" value="Cisco Switch">

            <label for="name">Inventory Number/ID</label>
            <input type="text" name="id" id="id" value="123456">
        </div>
        <div class="form-group">
            <label for="name">Manufacturer</label>
            <input type="text" name="manufacturer" id="manufacturer" value="Cisco">

            <label for="location">Location</label>
            <input type="text" name="location" id="location" value="A-1">
        </div>
        <div class="form-group">
            <label for="type">Asset Type</label>
            <select name="type" id="type">
                <option selected>Switch</option>
                <option>Router</option>
                <option disabled>Select an Asset Type</option>
            </select>
        </div>
        <i>If the asset's contract type is none, then the contract's form fields won't be displayed.
        If the asset contract type is set to none, then the contract details will be removed in the backend.
        </i>
        <div class="form-group">
            <label for="contract_type">Manufacturer Contract Type</label>
            <select name="contract_type" id="contract_type">
                <option>None</option>
                <option selected>Warranty</option>
                <option>Maintenance</option>
                <option>Support</option>
            </select>
        </div>
        <div id="contractDetails">
            <div class="form-group">
                <label for="contract_beginning_date">Contract Beginning Date</label>
                <input type="date" name="contract_beginning_date" id="contract_beginning_date" value="2022-01-01">

                <label for="contract_ending_date">Contract Ending Date</label>
                <input type="date" name="contract_ending_date" id="contract_ending_date" value="2025-01-01">

                <label for="contract_provider">Contract Provider</label>
                <input type="text" name="contract_provider" id="contract_provider" value="LisbonTech">
            </div>
        </div>
        <div class="form-group">
            <label for="description">Asset Description</label>
            <textarea name="description" id="description"></textarea>
        </div>
        <div class="form-group">
            <label for="cncs_visible">Visible to CNCS?</label>
            <input type="checkbox" name="cncs_visible" id="cncs_visible" checked>
            <label for="active">Active? (Only visible to SO)</label>
            <input type="checkbox" name="active" id="active" checked>
        </div>
        <div class="form-group">
            <label for="mac">MAC Address</label>
            <input type="text" name="mac" id="mac" value="AA:BB:CC:DD:EE:FF">

            <label for="ip">IP Address</label>
            <input type="text" name="ip" id="ip" value="192.168.1.1">
        </div>
        <i>In the backend, if the dependency is set, the current value will be displayed and the search form hidden. On editing, the search form will be displayed
        and the current value locally unset.
        </i>
        <div class="form-group" id="dependsCurrent">
            <input name="depends" value="123" id="dependsInput" hidden>
            <label for="currentDepends">Depends On</label>
            <a id="currentDepends" href="">Cisco Switch</a>
            <button id="editDependsButton" type="button"><i class="bi bi-pencil"></i></button>
        </div>
        <div class="form-group" id="dependsSearch" style="display: none">
            <label for="depends">Depends On</label>
            <input type="text" placeholder="Asset Name/ID/IP/MAC...">
            <button class="btn btn-primary" type="button"><i class="bi bi-search"></i></button>
            <select name="depends" id="depends">
                <option selected value="">None</option>
                <option disabled>Search for an Asset...</option>
                <option value="1">Cisco Router</option>
                <option value="2">Server #1</option>
                <option value="3">Server #2</option>
            </select>
        </div>
        <div class="form-group" id="managerCurrent">
            <input name="depends" value="123" id="managerInput" hidden>
            <label for="currentManager">Asset Manager</label>
            <a id="currentManager" href="">Pedro Sousa</a>
            <button id="editManagerButton" type="button"><i class="bi bi-pencil"></i></button>
        </div>
        <div class="form-group" id="managerSearch" style="display: none">
            <label for="manager">Asset Manager</label>
            <input type="text" placeholder="Name, E-Mail, Phone Number...">
            <button class="btn btn-primary" type="button"><i class="bi bi-search"></i></button>
            <select name="manager" id="manager">
                <option selected disabled hidden>Search for an Asset Manager...</option>
                <option value="1">John Doe</option>
                <option value="2">Jane Doe</option>
                <option value="3">John Johnson</option>
            </select>
        </div>
        <i>Only visible to the security officer. At any point, the asset status may be downgraded in order for the asset manager to repeat steps.</i>
        <br>
        <i>The backend will not allow upgrading the asset status if necessary data is missing.</i>
        <br>
        <i>Submitting the form on each step (if all data is valid) is sufficient to upgrade the asset status, excluding manual validation from the security officer and asset manager</i>
        <br>
        <i>The asset will be set as complete as soon as the asset manager finalizes confirming the remaining risk of the last treatment for each risk of the asset.
            If more risks/treatments are added, it will be downgraded to Threats/Treatments Set, and the cycle will be repeated.</i>
        <div class="form-group">
            <label for="status">Asset Status</label>
            <select name="status" id="status">
                <option disabled>Select the Asset Status...</option>
                <option selected>Initial</option>
                <option value="1">Threats Set</option>
                <option value="2">Treatments Set</option>
                <option value="3">Treatments Validated</option>
                <option value="4">Treatments Confirmed/Complete</option>
            </select>
        </div>
        <div id="appreciation">
            <div class="form-group">
                <label for="availability">Availability Appreciation</label>
                <input type="number" name="availability" id="availability" min="1" max="5" value="2">
            </div>
            <div class="form-group">
                <label for="integrity">Integrity Appreciation</label>
                <input type="number" name="integrity" id="integrity" min="1" max="5" value="4">
            </div>
            <div class="form-group">
                <label for="confidentiality">Confidentiality Appreciation</label>
                <input type="number" name="confidentiality" id="confidentiality" min="1" max="5" value="3">
            </div>
        </div>
        <div class="form-group">
            <label for="availability">Total Appreciation</label>
            <input type="number" id="total" value="3" min="0" max="3" disabled>
        </div>
        <div class="form-group">
            <button type="submit" class="btn btn-primary">Update Asset</button>
        </div>
    </form>
    <hr>
    <i>Should the manage asset controls and manage asset threats forms be put bellow the horizontal line or referenced by buttons?</i>
    <br>
    <button class="btn btn-success">Manage Asset Threats</button>
    <button class="btn btn-success">Manage Asset Controls</button>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
<script>
    $(document).ready(function() {
        $('#assetForm *').filter(':input').each(function(_,element){
            element.disabled = true;
        });
        $("#editFormButton").click(function(){
            $('#assetForm *').filter(':input').each(function(_,element){
                element.disabled = !element.disabled;
            });
            $("#total").prop("disabled",true);
        });
        $("#editDependsButton").click(function(){
            $("#dependsInput").remove();
            $("#dependsCurrent").hide();
            $("#dependsSearch").show();
        });
        $("#editManagerButton").click(function(){
            $("#managerInput").remove();
            $("#managerCurrent").hide();
            $("#managerSearch").show();

        });
        $("#contract_type").on("change",function(){
            let value = this.value;
            if (value==="None"){
                $("#contractDetails").hide();
            }
            else{
                $("#contractDetails").show();
            }
        });
        $('#appreciation input').each(function() {
            $(this).change(function() {
                let availability = $("#availability").val();
                let integrity = $("#integrity").val();
                let confidentiality = $("#confidentiality").val();
                let max = Math.max(availability,integrity,confidentiality);
                $("#total").val(max);
            });
        });
        //on manager or asset dependency search, if it only returns 1 result, make the select select such result
        //if the search term is #ID, search only for the PK

    });
</script>
<script>
</script>
</body>
</html>